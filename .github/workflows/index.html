<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Profesyonel Ekonomi Monitörü</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #2d3436;
            margin: 0;
            padding: 20px;
        }

        /* --- SEKME YAPISI --- */
        .tab-container { max-width: 1400px; margin: 0 auto; }
        .tab-nav {
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px;
            border-bottom: 2px solid #e1e4e8; margin-bottom: 30px;
        }
        .tab-btn {
            background: none; border: none; padding: 12px 20px; font-size: 15px;
            font-weight: 600; color: #636e72; cursor: pointer; border-radius: 8px;
            transition: all 0.2s; white-space: nowrap;
        }
        .tab-btn:hover { background-color: #dfe6e9; color: #2d3436; }
        .tab-btn.active { background-color: #0984e3; color: white; box-shadow: 0 4px 10px rgba(9, 132, 227, 0.3); }

        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- GRID YAPISI (Satır Bazlı) --- */
        .row-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        /* İkincil sekmeler için esnek yapı */
        .flex-row { display: flex; gap: 20px; flex-wrap: wrap; }
        .flex-item { flex: 1; min-width: 300px; max-width: 450px; }

        /* --- KART TASARIMI --- */
        .card {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 2px solid transparent;
            cursor: pointer; transition: all 0.2s;
            display: flex; flex-direction: column; position: relative;
        }
        .card:hover { transform: translateY(-4px); box-shadow: 0 8px 25px rgba(0,0,0,0.08); }
        .card.active-card { border-color: #0984e3; background-color: #fdfdfd; }

        .card-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #f1f2f6;
        }
        .card-title { font-size: 16px; font-weight: 700; margin: 0; color: #2d3436; }
        .card-date { font-size: 11px; background: #dfe6e9; color: #636e72; padding: 4px 8px; border-radius: 4px; }
        
        .metric { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 14px; }
        .metric-label { color: #636e72; font-weight: 500; }
        .metric-value { font-weight: 700; color: #2d3436; }
        .hint { margin-top: auto; text-align: center; font-size: 11px; color: #0984e3; padding-top: 10px; font-weight: 500; }

        /* --- BÜYÜK PANEL (FULL WIDTH) --- */
        .full-panel-container {
            grid-column: 1 / -1; /* Tüm satırı kaplar */
            display: none; /* Varsayılan gizli */
            margin-bottom: 30px;
        }
        
        .panel-content {
            background: #fff;
            border: 2px solid #0984e3;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 15px 30px rgba(9, 132, 227, 0.1);
            position: relative;
        }
        
        /* Panel başlığı ve kapatma butonu */
        .panel-top { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .panel-title { font-size: 18px; font-weight: bold; color: #0984e3; }
        .close-btn { cursor: pointer; color: #d63031; font-weight: bold; }

        .big-chart-box {
            height: 350px; /* Grafik yüksekliği artırıldı */
            width: 100%;
        }

        /* GSYH Alt Gridleri */
        .sub-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
        .mini-card { background: #f8f9fa; border-radius: 8px; padding: 15px; text-align: center; border: 1px solid #e9ecef; }
        .mini-title { font-size: 12px; color: #636e72; font-weight: 600; margin-bottom: 5px; height: 32px; display: flex; align-items: center; justify-content: center; }
        .mini-val { font-size: 18px; font-weight: 800; color: #2d3436; margin-bottom: 5px; }
        .mini-date { font-size: 10px; color: #b2bec3; }
        .mini-chart-box { height: 60px; width: 100%; margin-top: 5px; }

        /* TCMB ve İmalat Çift Grafik Yapısı */
        .double-chart-row { display: flex; gap: 20px; height: 350px; }
        .chart-half { flex: 1; position: relative; }

        /* Mobil Uyum */
        @media (max-width: 1200px) { 
            .row-grid { grid-template-columns: repeat(2, 1fr); } 
            .sub-grid { grid-template-columns: repeat(3, 1fr); }
            .double-chart-row { flex-direction: column; height: auto; }
            .chart-half { height: 250px; margin-bottom: 20px; }
        }
        @media (max-width: 700px) { 
            .row-grid { grid-template-columns: 1fr; } 
            .sub-grid { grid-template-columns: repeat(2, 1fr); }
        }
        /* --- TREND OKLARI İÇİN STİLLER --- */
        .trend-up { color: #00b894; font-weight: bold; margin-left: 5px; font-size: 14px; } /* Yeşil Ok */
        .trend-down { color: #d63031; font-weight: bold; margin-left: 5px; font-size: 14px; } /* Kırmızı Ok */
        .trend-stable { color: #b2bec3; margin-left: 5px; font-size: 12px; } /* Değişim Yok */
    </style>
</head>
<body>

<div class="tab-container">
    
    <nav class="tab-nav">
        <button class="tab-btn active" onclick="openTab('tab1')">Makroekonomik Birincil Göstergeler</button>
        <button class="tab-btn" onclick="openTab('tab2')">Makroekonomik İkincil Göstergeler</button>
        <button class="tab-btn" onclick="openTab('tab3')">ABD Makro Göstergeler</button>
        <button class="tab-btn" onclick="openTab('tab4')">Euro Bölgesi Makro Göstergeler</button>
        <button class="tab-btn" onclick="openTab('tab5')">Para ve Banka Göstergeleri</button>
    </nav>

    <div id="tab1" class="tab-content active">
        
        <div class="row-grid">
            <div class="card" onclick="togglePanel('panel-gsyh', this)">
                <div class="card-header"><h3 class="card-title">GSYH</h3><span class="card-date" id="d-gsyh">...</span></div>
                <div class="metric"><span class="metric-label">Büyüme (Yıllık):</span><span class="metric-value" id="v-gsyh-yil">...</span></div>
                <div class="hint">Öncü Göstergeler & Grafik ▼</div>
            </div>

            <div class="card" onclick="togglePanel('panel-tufe', this)">
                <div class="card-header"><h3 class="card-title">TÜFE</h3><span class="card-date" id="d-tufe">...</span></div>
                <div class="metric"><span class="metric-label">Aylık:</span><span class="metric-value" id="v-tufe-ay">...</span></div>
                <div class="metric"><span class="metric-label">Yıllık:</span><span class="metric-value" id="v-tufe-yil">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>

            <div class="card" onclick="togglePanel('panel-ufe', this)">
                <div class="card-header"><h3 class="card-title">Yİ-ÜFE</h3><span class="card-date" id="d-ufe">...</span></div>
                <div class="metric"><span class="metric-label">Aylık:</span><span class="metric-value" id="v-ufe-ay">...</span></div>
                <div class="metric"><span class="metric-label">Yıllık:</span><span class="metric-value" id="v-ufe-yil">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>

            <div class="card" onclick="togglePanel('panel-cari', this)">
                <div class="card-header"><h3 class="card-title">Cari Denge</h3><span class="card-date" id="d-cari">...</span></div>
                <div class="metric"><span class="metric-label">Aylık:</span><span class="metric-value" id="v-cari-ay">...</span></div>
                <div class="metric"><span class="metric-label">Yıllık:</span><span class="metric-value" id="v-cari-yil">...</span></div>
                <div class="metric"><span class="metric-label">Altın&Enerji Hariç (Aylık):</span><span class="metric-value" id="v-cari-cek-ay">...</span></div>
                <div class="metric"><span class="metric-label">Altın&Enerji Hariç (Yıllık):</span><span class="metric-value" id="v-cari-cek-yil">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>
        </div>

        <div id="panel-gsyh" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">Gayrisafi Yurt İçi Hasıla Detayları</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-gsyh"></canvas></div>
                <div class="sub-grid">
                    <div class="mini-card"><div class="mini-title">Sanayi Üretimi</div><div class="mini-val" id="v-sub-sanayi">...</div><div class="mini-chart-box"><canvas id="ch-sub-sanayi"></canvas></div></div>
                    <div class="mini-card"><div class="mini-title">Hizmet Üretimi</div><div class="mini-val" id="v-sub-hizmet">...</div><div class="mini-chart-box"><canvas id="ch-sub-hizmet"></canvas></div></div>
                    <div class="mini-card"><div class="mini-title">Ticaret Satış</div><div class="mini-val" id="v-sub-ticaret">...</div><div class="mini-chart-box"><canvas id="ch-sub-ticaret"></canvas></div></div>
                    <div class="mini-card"><div class="mini-title">Perakende Satış</div><div class="mini-val" id="v-sub-perakende">...</div><div class="mini-chart-box"><canvas id="ch-sub-perakende"></canvas></div></div>
                    <div class="mini-card"><div class="mini-title">İnşaat Üretimi</div><div class="mini-val" id="v-sub-insaat">...</div><div class="mini-chart-box"><canvas id="ch-sub-insaat"></canvas></div></div>
                </div>
            </div>
        </div>

        <div id="panel-tufe" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">Tüketici Fiyat Endeksi (TÜFE) - Yıllık Değişim</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-tufe"></canvas></div>
            </div>
        </div>

        <div id="panel-ufe" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">Yurt İçi Üretici Fiyat Endeksi (Yİ-ÜFE)</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-ufe"></canvas></div>
            </div>
        </div>

        <div id="panel-cari" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">Ödemeler Dengesi (Cari Açık/Fazla)</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-cari"></canvas></div>
            </div>
        </div>


        <div class="row-grid">
            <div class="card" onclick="togglePanel('panel-butce', this)">
                <div class="card-header"><h3 class="card-title">Merkezi Yönetim Bütçe Dengesi</h3><span class="card-date" id="d-butce">...</span></div>
                <div class="metric"><span class="metric-label">Bütçe (Aylık):</span><span class="metric-value" id="v-butce-ay">...</span></div>
                <div class="metric"><span class="metric-label">Bütçe (Yıllık):</span><span class="metric-value" id="v-butce-yil">...</span></div>
                <div class="metric"><span class="metric-label">Faiz Dışı (Aylık):</span><span class="metric-value" id="v-butce-fd-ay">...</span></div>
                <div class="metric"><span class="metric-label">Faiz Dışı (Yıllık):</span><span class="metric-value" id="v-butce-fd-yil">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>

            <div class="card" onclick="togglePanel('panel-nakit', this)">
                <div class="card-header"><h3 class="card-title">Hazine Nakit Dengesi</h3><span class="card-date" id="d-nakit">...</span></div>
                <div class="metric"><span class="metric-label">Nakit (Aylık):</span><span class="metric-value" id="v-nakit-ay">...</span></div>
                <div class="metric"><span class="metric-label">Nakit (Yıllık):</span><span class="metric-value" id="v-nakit-yil">...</span></div>
                <div class="metric"><span class="metric-label">Faiz Dışı (Aylık):</span><span class="metric-value" id="v-nakit-fd-ay">...</span></div>
                <div class="metric"><span class="metric-label">Faiz Dışı (Yıllık):</span><span class="metric-value" id="v-nakit-fd-yil">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>

            <div class="card" onclick="togglePanel('panel-isgucu', this)">
                <div class="card-header"><h3 class="card-title">İşgücü</h3><span class="card-date" id="d-isgucu">...</span></div>
                <div class="metric"><span class="metric-label">İşsizlik:</span><span class="metric-value" id="v-issiz">...</span></div>
                <div class="metric"><span class="metric-label">Atıl İşgücü:</span><span class="metric-value" id="v-atil">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>

            <div class="card" onclick="togglePanel('panel-fon', this)">
                <div class="card-header"><h3 class="card-title">TCMB Fonlama</h3><span class="card-date" id="d-fon">...</span></div>
                <div class="metric"><span class="metric-label">AOFM:</span><span class="metric-value" id="v-aofm">...</span></div>
                <div class="metric"><span class="metric-label">TLREF:</span><span class="metric-value" id="v-tlref">...</span></div>
                <div class="metric"><span class="metric-label">Net Fonlama:</span><span class="metric-value" id="v-netfon">...</span></div>
                <div class="hint">Detaylı Paneller ▼</div>
            </div>
        </div>

        <div id="panel-butce" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">Merkezi Yönetim Bütçe Dengesi</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-butce"></canvas></div>
            </div>
        </div>

        <div id="panel-nakit" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">Hazine Nakit Dengesi</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-nakit"></canvas></div>
            </div>
        </div>

        <div id="panel-isgucu" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">İşgücü İstatistikleri</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-isgucu"></canvas></div>
            </div>
        </div>

        <div id="panel-fon" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">TCMB Fonlama ve Likidite (Son 30 Gün)</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="double-chart-row">
                    <div class="chart-half">
                        <h5 style="text-align:center; color:#636e72; margin-top:0;">Faiz Oranları (%)</h5>
                        <canvas id="ch-fon-rates"></canvas>
                    </div>
                    <div class="chart-half">
                        <h5 style="text-align:center; color:#636e72; margin-top:0;">Net Fonlama (Milyar TL)</h5>
                        <canvas id="ch-fon-net"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div id="tab2" class="tab-content">
        <div class="flex-row">
            <div class="flex-item">
                <div class="card" onclick="togglePanel('panel-imalat', this)">
                    <div class="card-header"><h3 class="card-title">İmalat Sanayi</h3><span class="card-date" id="d-imalat">...</span></div>
                    <div class="metric"><span class="metric-label">PMI:</span><span class="metric-value" id="v-pmi">...</span></div>
                    <div class="metric"><span class="metric-label">KKO:</span><span class="metric-value" id="v-kko">...</span></div>
                    <div class="hint">Detaylı Grafikler ▼</div>
                </div>
            </div>
            <div class="flex-item">
                <div class="card" onclick="togglePanel('panel-guven', this)">
                    <div class="card-header"><h3 class="card-title">Güven Endeksleri</h3><span class="card-date" id="d-guven">...</span></div>
                    <div class="metric"><span class="metric-label">Tüketici:</span><span class="metric-value" id="v-guven-tuk">...</span></div>
                    <div class="metric"><span class="metric-label">Reel Kesim:</span><span class="metric-value" id="v-guven-reel">...</span></div>
                    <div class="hint">Grafiği Göster ▼</div>
                </div>
            </div>
        </div>

        <div id="panel-imalat" class="full-panel-container" style="margin-top:20px;">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">İmalat Sanayi Görünümü</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="double-chart-row">
                    <div class="chart-half">
                        <h5 style="text-align:center; color:#636e72; margin-top:0;">İmalat Sanayi PMI</h5>
                        <canvas id="ch-pmi"></canvas>
                    </div>
                    <div class="chart-half">
                        <h5 style="text-align:center; color:#636e72; margin-top:0;">İmalat Sanayi KKO (%)</h5>
                        <canvas id="ch-kko"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-guven" class="full-panel-container" style="margin-top:20px;">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">Güven Endeksleri (1 Ay Gecikmeli)</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-guven"></canvas></div>
            </div>
        </div>
    </div>

    <div id="tab3" class="tab-content">
        <div class="row-grid">
            <div class="card" onclick="togglePanel('panel-fed', this)">
                <div class="card-header"><h3 class="card-title">FED Faiz Oranları</h3><span class="card-date" id="d-fed">...</span></div>
                <div class="metric"><span class="metric-label">Üst Limit:</span><span class="metric-value" id="v-fed-ust">...</span></div>
                <div class="metric"><span class="metric-label">Efektif:</span><span class="metric-value" id="v-fed-eff">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>
        
            <div class="card" onclick="togglePanel('panel-uscpi', this)">
                <div class="card-header"><h3 class="card-title">ABD TÜFE</h3><span class="card-date" id="d-uscpi">...</span></div>
                <div class="metric"><span class="metric-label">Aylık:</span><span class="metric-value" id="v-uscpi-ay">...</span></div>
                <div class="metric"><span class="metric-label">Yıllık:</span><span class="metric-value" id="v-uscpi-yil">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>
        </div>
        
        <div id="panel-fed" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">FED Politika Faizi ve Efektif Fonlama</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-fed"></canvas></div>
            </div>
        </div>
        
        <div id="panel-uscpi" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">ABD Tüketici Fiyat Endeksi (Yıllık Değişim)</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-uscpi"></canvas></div>
            </div>
        </div>
    </div>
    
    <div id="tab4" class="tab-content">
        <div class="row-grid">
            <div class="card" onclick="togglePanel('panel-ecb', this)">
                <div class="card-header"><h3 class="card-title">ECB Faiz Oranları</h3><span class="card-date" id="d-ecb">...</span></div>
                <div class="metric"><span class="metric-label">Mevduat:</span><span class="metric-value" id="v-ecb-mev">...</span></div>
                <div class="metric"><span class="metric-label">Refinansman:</span><span class="metric-value" id="v-ecb-ref">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>
            
            <div class="card" onclick="togglePanel('panel-eurocpi', this)">
                <div class="card-header"><h3 class="card-title">Euro Bölgesi TÜFE</h3><span class="card-date" id="d-eurocpi">...</span></div>
                <div class="metric"><span class="metric-label">Aylık:</span><span class="metric-value" id="v-eurocpi-ay">...</span></div>
                <div class="metric"><span class="metric-label">Yıllık:</span><span class="metric-value" id="v-eurocpi-yil">...</span></div>
                <div class="hint">Grafiği Göster ▼</div>
            </div>
        </div>
        
        <div id="panel-ecb" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">Avrupa Merkez Bankası (ECB) Faiz Oranları</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-ecb"></canvas></div>
            </div>
        </div>
        
        <div id="panel-eurocpi" class="full-panel-container">
            <div class="panel-content">
                <div class="panel-top"><span class="panel-title">Euro Bölgesi Enflasyonu (Yıllık)</span><span class="close-btn" onclick="closeAllPanels()">X KAPAT</span></div>
                <div class="big-chart-box"><canvas id="ch-eurocpi"></canvas></div>
            </div>
        </div>
    </div> 
    
    <div id="tab5" class="tab-content">
        <div style="text-align:center; padding:50px; color:#aaa;">
            <h3>Veri Bekleniyor...</h3>
        </div>
    </div>

<script>
    // --- FORMATLAYICILAR ---
    const fmtDec1 = (n) => n !== null ? "%" + Number(n).toFixed(1) : "...";
    const fmtDec2 = (n) => n !== null ? "%" + Number(n).toFixed(2) : "...";
    const fmtThous = (n) => n !== null ? Number(n).toLocaleString('tr-TR') : "...";
    const fmtMUSD = (n) => n !== null ? Number(n).toLocaleString('tr-TR') + " M$" : "...";
    // YENİ FORMATLAYICI: Tam sayı (yuvarlanmış) + M₺
    const fmtMTRY = (n) => n !== null ? Math.round(Number(n)).toLocaleString('tr-TR') + " M₺" : "...";

    // --- TREND OKU HESAPLAYICI ---
    // reverse = true ise (Enflasyon, İşsizlik gibi) yükseliş KÖTÜ (Kırmızı), düşüş İYİ (Yeşil) olur.
    // reverse = false ise (Büyüme, Rezerv gibi) yükseliş İYİ (Yeşil), düşüş KÖTÜ (Kırmızı) olur.
    function getTrend(val, prev, reverse = false) {
        if (val === null || prev === null || val === undefined || prev === undefined) return '';

        let html = '';
        // Sayısal karşılaştırma (küçük küsurat farklarını yoksaymak için epsilon kullanılabilir ama basit tutuyoruz)
        if (val > prev) {
            // Yükseliş
            let arrow = '▲';
            let cssClass = reverse ? 'trend-down' : 'trend-up'; // Reverse ise (örn: enflasyon arttı) Kırmızı yap
            html = `<span class="${cssClass}">${arrow}</span>`;
        } else if (val < prev) {
            // Düşüş
            let arrow = '▼';
            let cssClass = reverse ? 'trend-up' : 'trend-down'; // Reverse ise (örn: enflasyon düştü) Yeşil yap
            html = `<span class="${cssClass}">${arrow}</span>`;
        } else {
            // Değişim Yok
            html = `<span class="trend-stable">●</span>`;
        }
        return html;
    }

    // --- SEKME VE PANEL YÖNETİMİ ---
    function openTab(id) {
        document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function closeAllPanels() {
        document.querySelectorAll('.full-panel-container').forEach(e => e.style.display = 'none');
        document.querySelectorAll('.card').forEach(e => e.classList.remove('active-card'));
    }

    function togglePanel(id, card) {
        const panel = document.getElementById(id);
        const isVisible = panel.style.display === 'block';
        closeAllPanels(); 
        if (!isVisible) {
            panel.style.display = 'block';
            card.classList.add('active-card');
        }
    }

    // --- GRAFİK ÇİZİM FONKSİYONU ---
    function drawChart(ctxId, type, labels, datasets, opts = {}) {
        const ctx = document.getElementById(ctxId);
        if (!ctx) return;

        const chartStatus = Chart.getChart(ctxId);
        if (chartStatus != undefined) { chartStatus.destroy(); }

        const defaultOpts = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: type !== 'mini', position: 'bottom' } },
            interaction: { mode: 'index', intersect: false },
            elements: { point: { radius: type === 'mini' ? 0 : 3, hitRadius: 10 } },
            scales: type === 'mini' ? { x: { display: false }, y: { display: false } } : {}
        };

        new Chart(ctx, {
            type: type === 'mini' ? 'line' : type,
            data: { labels: labels, datasets: datasets },
            options: { ...defaultOpts, ...opts }
        });
    }

    // --- ANA VERİ ÇEKME VE İŞLEME ---
    fetch('veri.json?t=' + new Date().getTime()).then(r => r.json()).then(d => {

        // 1. GSYH (Yükseliş İyi -> false)
        if (d.gsyh && d.gsyh.length > 0) {
            const s = d.gsyh[d.gsyh.length - 1];
            const prev = d.gsyh.length > 1 ? d.gsyh[d.gsyh.length - 2] : null;

            if (document.getElementById('d-gsyh')) document.getElementById('d-gsyh').innerText = s.tarih;
            if (document.getElementById('v-gsyh-yil')) 
                document.getElementById('v-gsyh-yil').innerHTML = fmtDec1(s.yillik) + (prev ? getTrend(s.yillik, prev.yillik, false) : "");
            
            drawChart('ch-gsyh', 'bar', d.gsyh.map(x => x.tarih), [{ label: 'Yıllık Büyüme', data: d.gsyh.map(x => x.yillik), backgroundColor: '#00b894' }]);
        }

// 1.1 GSYH ÖNCÜ GÖSTERGELER (GÜNCELLENDİ)
        if (d.gsyh_oncu) {
            d.gsyh_oncu.forEach(item => {
                const tur = item.tur;
                const veri = item.data;
                
                if (veri && veri.length > 0) {
                    // DEĞİŞİKLİK BURADA: 
                    // Sadece son elemanı almak yerine, değeri null/boş olmayanları filtreliyoruz.
                    const doluVeriler = veri.filter(x => x.yillik !== null && x.yillik !== "" && x.yillik !== undefined);

                    // Eğer elinizde geçerli veri varsa işlemi yap
                    if (doluVeriler.length > 0) {
                        const son = doluVeriler[doluVeriler.length - 1]; // Dolu olanların en sonuncusu
                        const onceki = doluVeriler.length > 1 ? doluVeriler[doluVeriler.length - 2] : null;

                        const valId = `v-sub-${tur}`;
                        const chId = `ch-sub-${tur}`;
                        
                        if (document.getElementById(valId)) 
                            document.getElementById(valId).innerHTML = fmtDec1(son.yillik) + (onceki ? getTrend(son.yillik, onceki.yillik, false) : "");

                        // Grafiği çizerken de boş verileri dahil etmeyelim ki grafik sonda yere çakılmasın
                        const miniData = doluVeriler.slice(-12); 
                        
                        drawChart(chId, 'mini', miniData.map(x => x.tarih), [{
                            data: miniData.map(x => x.yillik),
                            // Rengi belirlerken "son" değişkeni artık en güncel dolu veriyi temsil ediyor
                            borderColor: son.yillik >= 0 ? '#00b894' : '#d63031',
                            borderWidth: 2, tension: 0.3
                        }]);
                    }
                }
            });
        }

        // 2. TÜFE (Yükseliş Kötü -> true)
        if (d.tufe && d.tufe.length > 0) {
            const s = d.tufe[d.tufe.length - 1];
            const prev = d.tufe.length > 1 ? d.tufe[d.tufe.length - 2] : null;

            if (document.getElementById('d-tufe')) document.getElementById('d-tufe').innerText = s.tarih;
            if (document.getElementById('v-tufe-ay')) 
                document.getElementById('v-tufe-ay').innerHTML = fmtDec2(s.aylik) + (prev ? getTrend(s.aylik, prev.aylik, true) : "");
            if (document.getElementById('v-tufe-yil')) 
                document.getElementById('v-tufe-yil').innerHTML = fmtDec2(s.yillik) + (prev ? getTrend(s.yillik, prev.yillik, true) : "");
            
            drawChart('ch-tufe', 'line', d.tufe.map(x => x.tarih), [{ label: 'Yıllık TÜFE', data: d.tufe.map(x => x.yillik), borderColor: '#d63031', fill: true, backgroundColor: 'rgba(214,48,49,0.1)' }]);
        }

        // 3. Yİ-ÜFE (Yükseliş Kötü -> true)
        if (d.ufe && d.ufe.length > 0) {
            const s = d.ufe[d.ufe.length - 1];
            const prev = d.ufe.length > 1 ? d.ufe[d.ufe.length - 2] : null;

            if (document.getElementById('d-ufe')) document.getElementById('d-ufe').innerText = s.tarih;
            if (document.getElementById('v-ufe-ay')) 
                document.getElementById('v-ufe-ay').innerHTML = fmtDec2(s.aylik) + (prev ? getTrend(s.aylik, prev.aylik, true) : "");
            if (document.getElementById('v-ufe-yil')) 
                document.getElementById('v-ufe-yil').innerHTML = fmtDec2(s.yillik) + (prev ? getTrend(s.yillik, prev.yillik, true) : "");

            drawChart('ch-ufe', 'line', d.ufe.map(x => x.tarih), [{ label: 'Yıllık Yİ-ÜFE', data: d.ufe.map(x => x.yillik), borderColor: '#e17055' }]);
        }

        // 4. CARİ (Yükseliş/Fazla İyi -> false)
        if (d.cari && d.cari.length > 0) {
            const s = d.cari[d.cari.length - 1];
            const prev = d.cari.length > 1 ? d.cari[d.cari.length - 2] : null;

            if (document.getElementById('d-cari')) document.getElementById('d-cari').innerText = s.tarih;
            if (document.getElementById('v-cari-ay')) 
                document.getElementById('v-cari-ay').innerHTML = fmtMUSD(s.cari_aylik)+ (prev ? getTrend(s.cari_aylik, prev.cari_aylik, false) : "");
            if (document.getElementById('v-cari-yil')) 
                document.getElementById('v-cari-yil').innerHTML = fmtMUSD(s.cari_yillik) + (prev ? getTrend(s.cari_yillik, prev.cari_yillik, false) : "");
            if (document.getElementById('v-cari-cek-ay')) 
                document.getElementById('v-cari-cek-ay').innerHTML = fmtMUSD(s.cekirdek_aylik)+ (prev ? getTrend(s.cekirdek_aylik, prev.cekirdek_aylik, false) : "");
            if (document.getElementById('v-cari-cek-yil')) 
                document.getElementById('v-cari-cek-yil').innerHTML = fmtMUSD(s.cekirdek_yillik)+ (prev ? getTrend(s.cekirdek_yillik, prev.cekirdek_yillik, false) : "");

            drawChart('ch-cari', 'line', d.cari.map(x => x.tarih), [
                { label: 'Cari Denge (Yıllık)', data: d.cari.map(x => x.cari_yillik), borderColor: '#d63031' },
                { label: 'Çekirdek Denge', data: d.cari.map(x => x.cekirdek_yillik), borderColor: '#00b894', borderDash: [5, 5] }
            ]);
        }

        // 5. BÜTÇE (Yükseliş/Fazla İyi -> false) - GÜNCELLENDİ (fmtMTRY)
        if (d.butce && d.butce.length > 0) {
            const s = d.butce[d.butce.length - 1];
            const prev = d.butce.length > 1 ? d.butce[d.butce.length - 2] : null;

            if (document.getElementById('d-butce')) document.getElementById('d-butce').innerText = s.tarih;
            if (document.getElementById('v-butce-ay')) 
                document.getElementById('v-butce-ay').innerHTML = fmtMTRY(s.butce_aylik)+ (prev ? getTrend(s.butce_aylik, prev.butce_aylik, false) : "");
            if (document.getElementById('v-butce-yil')) 
                document.getElementById('v-butce-yil').innerHTML = fmtMTRY(s.butce_yillik) + (prev ? getTrend(s.butce_yillik, prev.butce_yillik, false) : "");
            if (document.getElementById('v-butce-fd-ay')) 
                document.getElementById('v-butce-fd-ay').innerHTML = fmtMTRY(s.faizdisi_aylik) + (prev ? getTrend(s.faizdisi_aylik, prev.faizdisi_aylik, false) : "");
            if (document.getElementById('v-butce-fd-yil')) 
                document.getElementById('v-butce-fd-yil').innerHTML = fmtMTRY(s.faizdisi_yillik) + (prev ? getTrend(s.faizdisi_yillik, prev.faizdisi_yillik, false) : "");

            drawChart('ch-butce', 'line', d.butce.map(x => x.tarih), [
                { label: 'Bütçe (Yıllık)', data: d.butce.map(x => x.butce_yillik), borderColor: '#e17055' },
                { label: 'Faiz Dışı', data: d.butce.map(x => x.faizdisi_yillik), borderColor: '#0984e3' }
            ]);
        }

        // 6. NAKİT (Yükseliş/Fazla İyi -> false) - GÜNCELLENDİ (fmtMTRY)
        if (d.nakit && d.nakit.length > 0) {
            const s = d.nakit[d.nakit.length - 1];
            const prev = d.nakit.length > 1 ? d.nakit[d.nakit.length - 2] : null;

            if (document.getElementById('d-nakit')) document.getElementById('d-nakit').innerText = s.tarih;
            if (document.getElementById('v-nakit-ay')) 
                document.getElementById('v-nakit-ay').innerHTML = fmtMTRY(s.nakit_aylik) + (prev ? getTrend(s.nakit_aylik, prev.nakit_aylik, false) : "");
            if (document.getElementById('v-nakit-yil')) 
                document.getElementById('v-nakit-yil').innerHTML = fmtMTRY(s.nakit_yillik) + (prev ? getTrend(s.nakit_yillik, prev.nakit_yillik, false) : "");
            if (document.getElementById('v-nakit-fd-ay')) 
                document.getElementById('v-nakit-fd-ay').innerHTML = fmtMTRY(s.faizdisi_aylik) + (prev ? getTrend(s.faizdisi_aylik, prev.faizdisi_aylik, false) : "");
            if (document.getElementById('v-nakit-fd-yil')) 
                document.getElementById('v-nakit-fd-yil').innerHTML = fmtMTRY(s.faizdisi_yillik) + (prev ? getTrend(s.faizdisi_yillik, prev.faizdisi_yillik, false) : "");

            drawChart('ch-nakit', 'line', d.nakit.map(x => x.tarih), [{ label: 'Nakit (Yıllık)', data: d.nakit.map(x => x.nakit_yillik), borderColor: '#00b894' }]);
        }

        // 7. İŞGÜCÜ (İşsizlik/Atıl Yükselişi Kötü -> true)
        if (d.isgucu && d.isgucu.length > 0) {
            const s = d.isgucu[d.isgucu.length - 1];
            const prev = d.isgucu.length > 1 ? d.isgucu[d.isgucu.length - 2] : null;

            if (document.getElementById('d-isgucu')) document.getElementById('d-isgucu').innerText = s.tarih;
            if (document.getElementById('v-issiz')) 
                document.getElementById('v-issiz').innerHTML = fmtDec1(s.issizlik) + (prev ? getTrend(s.issizlik, prev.issizlik, true) : "");
            if (document.getElementById('v-atil')) 
                document.getElementById('v-atil').innerHTML = fmtDec1(s.atil) + (prev ? getTrend(s.atil, prev.atil, true) : "");
            
            drawChart('ch-isgucu', 'line', d.isgucu.map(x => x.tarih), [
                { label: 'İşsizlik', data: d.isgucu.map(x => x.issizlik), borderColor: '#d63031' },
                { label: 'Atıl İşgücü', data: d.isgucu.map(x => x.atil), borderColor: '#fdcb6e' }
            ]);
        }

        // 8. TCMB FONLAMA (Faizler nötr/standart -> false)
        if (d.fonlama && d.fonlama.length > 0) {
            const s = d.fonlama[d.fonlama.length - 1];
            const prev = d.fonlama.length > 1 ? d.fonlama[d.fonlama.length - 2] : null;

            if (document.getElementById('d-fon')) document.getElementById('d-fon').innerText = s.tarih;
            if (document.getElementById('v-aofm')) 
                document.getElementById('v-aofm').innerHTML = fmtDec2(s.aofm) + (prev ? getTrend(s.aofm, prev.aofm, false) : "");
            if (document.getElementById('v-tlref')) 
                document.getElementById('v-tlref').innerHTML = fmtDec2(s.tlref) + (prev ? getTrend(s.tlref, prev.tlref, false) : "");
            if (document.getElementById('v-netfon')) 
                document.getElementById('v-netfon').innerHTML = fmtThous(s.net_fonlama) + (prev ? getTrend(s.tlref, prev.tlref, false) : "");

            const son = d.fonlama.slice(-30);
            drawChart('ch-fon-rates', 'line', son.map(x => x.tarih), [
                { label: 'AOFM', data: son.map(x => x.aofm), borderColor: '#6c5ce7' },
                { label: 'TLREF', data: son.map(x => x.tlref), borderColor: '#00cec9' }
            ]);
            drawChart('ch-fon-net', 'bar', son.map(x => x.tarih), [
                { label: 'Net Fonlama', data: son.map(x => x.net_fonlama), backgroundColor: '#fab1a0' }
            ]);
        }

        // 9. İMALAT (PMI Yükseliş İyi -> false)
        if (d.imalat && d.imalat.length > 0) {
            const s = d.imalat[d.imalat.length - 1];
            const prev = d.imalat.length > 1 ? d.imalat[d.imalat.length - 2] : null;

            if (document.getElementById('d-imalat')) document.getElementById('d-imalat').innerText = s.tarih;
            if (document.getElementById('v-pmi')) 
                document.getElementById('v-pmi').innerHTML = Number(s.pmi).toFixed(1) + (prev ? getTrend(s.pmi, prev.pmi, false) : "");
            if (document.getElementById('v-kko')) 
                document.getElementById('v-kko').innerHTML = fmtDec1(s.kko) + (prev ? getTrend(s.kko, prev.kko, false) : "");

            drawChart('ch-pmi', 'line', d.imalat.map(x => x.tarih), [
                {
                    label: 'PMI',
                    data: d.imalat.map(x => x.pmi),
                    borderColor: '#0984e3',
                    backgroundColor: 'rgba(9, 132, 227, 0.1)',
                    fill: true
                }
            ]);
            drawChart('ch-kko', 'line', d.imalat.map(x => x.tarih), [
                {
                    label: 'KKO',
                    data: d.imalat.map(x => x.kko),
                    borderColor: '#e17055',
                    backgroundColor: 'rgba(225, 112, 85, 0.1)',
                    fill: true
                }
            ]);
        }

        // 10. GÜVEN (Yükseliş İyi -> false)
        if (d.guven && d.guven.length > 0) {
            // Güven endeksi genelde 1 ay gecikmeli/farklı yayınlanabilir, son veriyi alıyoruz
            const s = d.guven[d.guven.length - 1];
            const prev = d.guven.length > 1 ? d.guven[d.guven.length - 2] : null;

            if (document.getElementById('d-guven')) document.getElementById('d-guven').innerText = s.tarih;
            if (document.getElementById('v-guven-tuk')) 
                document.getElementById('v-guven-tuk').innerHTML = Math.round(s.tuketici) + (prev ? getTrend(s.tuketici, prev.tuketici, false) : "");
            if (document.getElementById('v-guven-reel')) 
                document.getElementById('v-guven-reel').innerHTML = Math.round(s.reel) + (prev ? getTrend(s.reel, prev.reel, false) : "");

            drawChart('ch-guven', 'line', d.guven.map(x => x.tarih), [
                { label: 'Tüketici', data: d.guven.map(x => x.tuketici), borderColor: '#636e72' },
                { label: 'Reel Kesim', data: d.guven.map(x => x.reel), borderColor: '#00b894' }
            ]);
        }

        // 11. ABD (Faiz Std, Enflasyon Ters)
        if (d.fed && d.fed.length > 0) {
            const s = d.fed[d.fed.length - 1];
            const prev = d.fed.length > 1 ? d.fed[d.fed.length - 2] : null;

            if (document.getElementById('d-fed')) document.getElementById('d-fed').innerText = s.tarih;
            if (document.getElementById('v-fed-ust')) 
                document.getElementById('v-fed-ust').innerHTML = fmtDec2(s.ust) + (prev ? getTrend(s.ust, prev.ust, false) : "");
            if (document.getElementById('v-fed-eff')) 
                document.getElementById('v-fed-eff').innerHTML = fmtDec2(s.efektif) + (prev ? getTrend(s.efektif, prev.efektif, false) : "");

            drawChart('ch-fed', 'line', d.fed.map(x => x.tarih), [
                { label: 'Üst Limit', data: d.fed.map(x => x.ust), borderColor: '#74b9ff', borderWidth: 1, borderDash: [5, 5] },
                { label: 'Efektif', data: d.fed.map(x => x.efektif), borderColor: '#0984e3', borderWidth: 2 },
                { label: 'Alt Limit', data: d.fed.map(x => x.alt), borderColor: '#74b9ff', borderWidth: 1, borderDash: [5, 5] }
            ]);
        }

        if (d.uscpi && d.uscpi.length > 0) {
            const s = d.uscpi[d.uscpi.length - 1];
            const prev = d.uscpi.length > 1 ? d.uscpi[d.uscpi.length - 2] : null;

            if (document.getElementById('d-uscpi')) document.getElementById('d-uscpi').innerText = s.tarih;
            if (document.getElementById('v-uscpi-ay')) 
                document.getElementById('v-uscpi-ay').innerHTML = fmtDec1(s.aylik) + (prev ? getTrend(s.aylik, prev.aylik, true) : "");
            if (document.getElementById('v-uscpi-yil')) 
                document.getElementById('v-uscpi-yil').innerHTML = fmtDec1(s.yillik) + (prev ? getTrend(s.yillik, prev.yillik, true) : "");

            drawChart('ch-uscpi', 'line', d.uscpi.map(x => x.tarih), [
                { label: 'ABD TÜFE (Yıllık)', data: d.uscpi.map(x => x.yillik), borderColor: '#d63031', fill: true, backgroundColor: 'rgba(214,48,49,0.1)' }
            ]);
        }

        // 12. EURO
        if (d.ecb && d.ecb.length > 0) {
            const s = d.ecb[d.ecb.length - 1];
            const prev = d.ecb.length > 1 ? d.ecb[d.ecb.length - 2] : null;

            if (document.getElementById('d-ecb')) document.getElementById('d-ecb').innerText = s.tarih;
            if (document.getElementById('v-ecb-mev')) 
                document.getElementById('v-ecb-mev').innerHTML = fmtDec2(s.mevduat) + (prev ? getTrend(s.mevduat, prev.mevduat, false) : "");
            if (document.getElementById('v-ecb-ref')) 
                document.getElementById('v-ecb-ref').innerHTML = fmtDec2(s.refinans) + (prev ? getTrend(s.refinans, prev.refinans, false) : "");

            drawChart('ch-ecb', 'line', d.ecb.map(x => x.tarih), [
                { label: 'Marjinal', data: d.ecb.map(x => x.marjinal), borderColor: '#fdcb6e' },
                { label: 'Refinansman', data: d.ecb.map(x => x.refinans), borderColor: '#0984e3' },
                { label: 'Mevduat', data: d.ecb.map(x => x.mevduat), borderColor: '#00b894' }
            ]);
        }

        if (d.eurocpi && d.eurocpi.length > 0) {
            const s = d.eurocpi[d.eurocpi.length - 1];
            const prev = d.eurocpi.length > 1 ? d.eurocpi[d.eurocpi.length - 2] : null;

            if (document.getElementById('d-eurocpi')) document.getElementById('d-eurocpi').innerText = s.tarih;
            if (document.getElementById('v-eurocpi-ay')) 
                document.getElementById('v-eurocpi-ay').innerHTML = fmtDec1(s.aylik) + (prev ? getTrend(s.aylik, prev.aylik, true) : "");
            if (document.getElementById('v-eurocpi-yil')) 
                document.getElementById('v-eurocpi-yil').innerHTML = fmtDec1(s.yillik) + (prev ? getTrend(s.yillik, prev.yillik, true) : "");

            drawChart('ch-eurocpi', 'line', d.eurocpi.map(x => x.tarih), [
                { label: 'Euro TÜFE (Yıllık)', data: d.eurocpi.map(x => x.yillik), borderColor: '#6c5ce7', fill: true, backgroundColor: 'rgba(108,92,231,0.1)' }
            ]);
        }
    }).catch(e => console.error("Veri okuma hatası:", e));
</script>

</body>
</html>